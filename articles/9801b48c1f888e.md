---
title: "ã€Androidã€‘BottomSheetDialogFragment ã§ Jetpack Compose ã‚’æ´»ç”¨ã™ã‚‹"
emoji: "ğŸ“±"
type: "tech"
topics: ["android", "jetpackcompose", "kotlin", "bottomsheetdialogfragment", "navigation"]
published: true
published_at: 2025-05-15 15:00
---

ã“ã‚“ã«ã¡ã¯ï¼ã‚¢ãƒ«ãƒ€ã‚°ãƒ©ãƒ ã§ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ã—ã¦ã„ã‚‹æ¸¡é‚Šã§ã™ï¼

å¼Šç¤¾ã§æä¾›ã—ã¦ã„ã‚‹ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã€ŒKANNAã€ã¯ã€ä¸»ã« React Native ã§é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ãŒã€ä¸€éƒ¨ã®æ©Ÿèƒ½ã‚„ç”»é¢ã§ã¯ Kotlin ã¨ Jetpack Compose ã‚’ç©æ¥µçš„ã«æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãªæ§‹æˆã«ãŠã„ã¦ã€`BottomSheetDialogFragment` ã¯ React Native ã‹ã‚‰ Jetpack Compose ã§æ§‹ç¯‰ã—ãŸç”»é¢ã‚„æ©Ÿèƒ½ã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«å‘¼ã³å‡ºã—ã€è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

ä»Šå›ã¯ã€Android é–‹ç™ºã§ `BottomSheetDialogFragment` ã‚’ä½¿ç”¨ã—ã¦ Jetpack Compose ã®ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹éš›ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã€ç‰¹ã«å…¨ç”»é¢è¡¨ç¤ºã‚„ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ¶å¾¡ã¨ã„ã£ãŸã€ã‚ˆã‚Šå¿«é©ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªæ–¹æ³•ã«ã¤ã„ã¦è©³ã—ãã”ç´¹ä»‹ã—ã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€ä»¥ä¸‹ã®3ã¤ã®ä¸»è¦ãªãƒã‚¤ãƒ³ãƒˆã«ç„¦ç‚¹ã‚’å½“ã¦ã¦è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

- `BottomSheetDialogFragment` ã‚’å…¨ç”»é¢ã§è¡¨ç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œã‚’ç„¡åŠ¹ã«ã™ã‚‹æ–¹æ³•
- `BottomSheetDialogFragment` å†…ã§ Jetpack Compose ã®UIã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªè¨­å®š
- `navigation-compose` ã‚’åˆ©ç”¨ã™ã‚‹éš›ã®ãƒãƒƒã‚¯ã‚­ãƒ¼ã®æŒ™å‹•ã‚’é©åˆ‡ã«åˆ¶å¾¡ã—ã€æ„å›³ã—ãŸé€šã‚Šã®ç”»é¢é·ç§»ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•

## BottomSheetDialogFragment ã‚’å…¨ç”»é¢ã§è¡¨ç¤ºã—ã€ã‚¹ãƒ¯ã‚¤ãƒ—ã‚’ç„¡åŠ¹ã«ã™ã‚‹æ–¹æ³•

`BottomSheetDialogFragment` ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç”»é¢ä¸‹éƒ¨ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å¿œã˜ãŸé«˜ã•ã§è¡¨ç¤ºã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¹ãƒ¯ã‚¤ãƒ—ãƒ€ã‚¦ãƒ³ã§ç°¡å˜ã«é–‰ã˜ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã€ç‰¹å®šã®ç”»é¢ã§ã¯å…¨ç”»é¢ã§è¡¨ç¤ºã—ã€æ„å›³ã—ãªã„ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œã§é–‰ã˜ã‚‰ã‚Œã‚‹ã®ã‚’é˜²ããŸã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã‚ˆã­ã€‚

ã“ã“ã§ã¯ã€ãã®ã‚ˆã†ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€`BottomSheetDialogFragment` ã‚’ç¶™æ‰¿ã—ãŸãƒ™ãƒ¼ã‚¹ã‚¯ãƒ©ã‚¹ `ComposeDialogFragment` ã‚’ä½œæˆã—ã€ãã®è¡¨ç¤ºæŒ™å‹•ã‚’èª¿æ•´ã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã€Stack Overflow ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹æƒ…å ±ã‚’å‚è€ƒã«ã€ãƒœãƒˆãƒ ã‚·ãƒ¼ãƒˆã‚’å…¨ç”»é¢ã§è¡¨ç¤ºã—ã€ã‹ã¤ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œã‚’ç„¡åŠ¹ã«ã™ã‚‹å®Ÿè£…ã§ã™ã€‚

```kotlin
abstract class ComposeDialogFragment : BottomSheetDialogFragment() {

    override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {
        val dialog = BottomSheetDialog(requireContext(), theme)

        fun setupFullHeight(bottomSheet: View) {
            val layoutParams = bottomSheet.layoutParams
            layoutParams.height = WindowManager.LayoutParams.MATCH_PARENT
            bottomSheet.layoutParams = layoutParams
        }

        // ãƒœãƒˆãƒ ã‚·ãƒ¼ãƒˆã®åˆæœŸè¡¨ç¤ºã‚’ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã«ã™ã‚‹.
        // å‚è€ƒ: https://stackoverflow.com/a/62958074
        dialog.setOnShowListener {
            val bottomSheet: View = dialog.findViewById(
                com.google.android.material.R.id.design_bottom_sheet
            ) ?: return@setOnShowListener

            val behavior = BottomSheetBehavior.from(bottomSheet)
            setupFullHeight(bottomSheet)
            behavior.state = BottomSheetBehavior.STATE_EXPANDED

            // ãƒœãƒˆãƒ ã‚·ãƒ¼ãƒˆã®ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œã‚’ç„¡åŠ¹ã«ã™ã‚‹.
            // å‚è€ƒ: https://stackoverflow.com/a/35794743
            behavior.addBottomSheetCallback(object : BottomSheetBehavior.BottomSheetCallback() {
                override fun onStateChanged(bottomSheet: View, newState: Int) {
                    if (newState == BottomSheetBehavior.STATE_DRAGGING) {
                        behavior.state = BottomSheetBehavior.STATE_EXPANDED
                    }
                }

                override fun onSlide(bottomSheet: View, slideOffset: Float) {
                }
            })
        }
        return dialog
    }
}
```

ã“ã®ã‚³ãƒ¼ãƒ‰ã®ä¸»ãªãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- `dialog.setOnShowListener` å†…ã§ã€ãƒœãƒˆãƒ ã‚·ãƒ¼ãƒˆã® `View` ã‚’å–å¾—ã™ã‚‹
- `setupFullHeight` é–¢æ•°ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ `WindowManager.LayoutParams.MATCH_PARENT` ã«è¨­å®šã—ã€é«˜ã•ã‚’ç”»é¢å…¨ä½“ã«åºƒã’ã‚‹
- `behavior.state = BottomSheetBehavior.STATE_EXPANDED` ã¨ã™ã‚‹ã“ã¨ã§ã€ãƒœãƒˆãƒ ã‚·ãƒ¼ãƒˆã‚’åˆæœŸçŠ¶æ…‹ã‹ã‚‰å±•é–‹ã•ã‚ŒãŸï¼ˆå…¨ç”»é¢ï¼‰çŠ¶æ…‹ã«ã™ã‚‹
- `behavior.addBottomSheetCallback` ã‚’ä½¿ã£ã¦ãƒœãƒˆãƒ ã‚·ãƒ¼ãƒˆã®çŠ¶æ…‹å¤‰åŒ–ã‚’ç›£è¦–ã™ã‚‹ã€‚`onStateChanged` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã€ã‚‚ã—çŠ¶æ…‹ãŒ `BottomSheetBehavior.STATE_DRAGGING`ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‰ãƒ©ãƒƒã‚°ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹çŠ¶æ…‹ï¼‰ã«ãªã£ãŸå ´åˆã€å³åº§ã« `behavior.state = BottomSheetBehavior.STATE_EXPANDED` ã¨ã™ã‚‹ã“ã¨ã§ã€ã‚¹ãƒ¯ã‚¤ãƒ—ã«ã‚ˆã‚‹ã‚¯ãƒ­ãƒ¼ã‚ºæ“ä½œã‚’å®Ÿè³ªçš„ã«ç„¡åŠ¹åŒ–ã™ã‚‹

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€`BottomSheetDialogFragment` ã‚’å¸¸ã«å…¨ç”»é¢ã§è¡¨ç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ„å›³ã›ãšé–‰ã˜ã¦ã—ã¾ã†ã®ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

## BottomSheetDialogFragment ã§ Compose ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®è¨­å®š

æ¬¡ã«ã€ä½œæˆã—ãŸ `ComposeDialogFragment` å†…ã§ Jetpack Compose ã® UI ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®åŸºæœ¬çš„ãªè¨­å®šæ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

Fragment å†…ã§ Compose ã® UI ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€`onCreateView` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã€`ComposeView` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¦è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®éš›ã€ç‰¹ã«é‡è¦ãªã®ãŒ `setViewCompositionStrategy` ãƒ¡ã‚½ãƒƒãƒ‰ã®è¨­å®šã§ã™ã€‚

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ([Compose in Fragments | Android Developers](https://developer.android.com/develop/ui/compose/migrate/interoperability-apis/compose-in-views#compose-in-fragments)) ã§ã‚‚æ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€`ViewCompositionStrategy.DisposeOnViewTreeLifecycleDestroyed` ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Fragment ã®ãƒ“ãƒ¥ãƒ¼ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«åˆã‚ã›ã¦ Compose ã®ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ãŒé©åˆ‡ã«ç ´æ£„ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã¨ã„ã£ãŸæ½œåœ¨çš„ãªå•é¡Œã‚’æœªç„¶ã«é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

```kotlin
abstract class ComposeDialogFragment : BottomSheetDialogFragment() {

    // onCreateDialog ã¯å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å®šç¾©æ¸ˆã¿
    override fun onCreateDialog(savedInstanceState: Bundle?): Dialog { /* ... */ }

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        return ComposeView(requireContext()).apply {
            // Fragment ã® View ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«åˆã‚ã›ã¦ Composition ã‚’ç ´æ£„ã™ã‚‹
            setViewCompositionStrategy(ViewCompositionStrategy.DisposeOnViewTreeLifecycleDestroyed)
            setContent {
                AppTheme { // AppTheme ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã™ã‚‹ãƒ†ãƒ¼ãƒ
                    Surface(modifier = Modifier.fillMaxSize()) {
                        this@ComposeDialogFragment.Content()
                    }
                }
            }
        }
    }

    @Composable
    abstract fun Content()
}
```
ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`onCreateView` ã§ `ComposeView` ã‚’ç”Ÿæˆã—ã€`setViewCompositionStrategy` ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚ãã—ã¦ `setContent` ãƒ–ãƒ­ãƒƒã‚¯å†…ã§ã€`AppTheme` (ã”è‡ªèº«ã®ã‚¢ãƒ—ãƒªã®ãƒ†ãƒ¼ãƒã«ç½®ãæ›ãˆã¦ãã ã•ã„) ã¨ `Surface` ã‚’ä½¿ç”¨ã—ã¦ã€å®Ÿéš›ã® Compose UI ã‚’æç”»ã™ã‚‹æº–å‚™ã‚’ã—ã¦ã„ã¾ã™ã€‚

`Content()` ãƒ¡ã‚½ãƒƒãƒ‰ã¯æŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ãŠã‚Šã€ã“ã® `ComposeDialogFragment` ã‚’ç¶™æ‰¿ã™ã‚‹å…·ä½“çš„ãª Fragment ã‚¯ãƒ©ã‚¹ã§ã€è¡¨ç¤ºã—ãŸã„ Compose UI ã‚’è‡ªç”±ã«å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## navigation-compose ã‚’ä½¿ã†å ´åˆã®ãƒãƒƒã‚¯ã‚­ãƒ¼ã®åˆ¶å¾¡æ–¹æ³•

`BottomSheetDialogFragment` å†…ã§ `navigation-compose` ã‚’ä½¿ã£ã¦è¤‡æ•°ã®ç”»é¢é–“ã‚’é·ç§»ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã€ä¸€ã¤æ³¨æ„ã™ã¹ãç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã¯ã€ãƒ‡ãƒã‚¤ã‚¹ã®ãƒãƒƒã‚¯ã‚­ãƒ¼ã‚’æŠ¼ã—ãŸéš›ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æŒ™å‹•ã§ã™ã€‚é€šå¸¸ã€ãƒãƒƒã‚¯ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ `navigation-compose` ã®å†…éƒ¨çš„ãªç”»é¢ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä¸€ã¤æˆ»ã‚‹ã®ã§ã¯ãªãã€`BottomSheetDialogFragment` è‡ªä½“ãŒé–‰ã˜ã‚‰ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€`BottomSheetDialog`ï¼ˆã‚ˆã‚Šæ­£ç¢ºã«ã¯ãã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹ã§ã‚ã‚‹ `ComponentDialog`ï¼‰ã® `onBackPressed()` ãŒå„ªå…ˆã—ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã§ã™ã€‚

ã“ã®æŒ™å‹•ã‚’å›é¿ã—ã€`navigation-compose` ã®ç”»é¢ã‚¹ã‚¿ãƒƒã‚¯ã‚’æœŸå¾…é€šã‚Šã«æ“ä½œã™ã‚‹ãŸã‚ã«ã¯ã€ãƒãƒƒã‚¯ã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸéš›ã®å‡¦ç†ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€ã¾ãš `navigation-compose` ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’ç¢ºèªã—ã€ã‚¹ã‚¿ãƒƒã‚¯å†…ã«æˆ»ã‚Œã‚‹ç”»é¢ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ãã¡ã‚‰ã‚’å„ªå…ˆã—ã¦æˆ»ã‚Šã€ã“ã‚Œä»¥ä¸Šæˆ»ã‚Œãªã„å ´åˆã«ã®ã¿ Fragment ã‚’é–‰ã˜ã‚‹ã€ã¨ã„ã†åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚

ã“ã®åˆ¶å¾¡ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹é‡ã§ `ComposeDialogFragmentNavHost` ã¨ã„ã†ãƒ©ãƒƒãƒ‘ãƒ¼ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

- `NavHost` ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹
- Jetpack Compose ã® `BackHandler` ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ã‚·ã‚¹ãƒ†ãƒ ãƒãƒƒã‚¯ã‚­ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ•æ‰ã™ã‚‹
- `CompositionLocalProvider` ã‚’ä½¿ç”¨ã—ã¦ `LocalOnBackPressedDispatcherOwner` ã‚’ç¾åœ¨ã® `dialog`ï¼ˆ`BottomSheetDialog` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ã«ä¸Šæ›¸ãã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒãƒƒã‚¯ã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒãƒ€ã‚¤ã‚¢ãƒ­ã‚°å´ã«ç§»è­²ã•ã‚Œã‚‹
- `navController.currentBackStack` ã‚’ç›£è¦–ã—ã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ãƒƒã‚¯å†…ã«æˆ»ã‚‹ã¹ãç”»é¢ãŒ1ã¤ã‚ˆã‚Šå¤šãå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’åˆ¤å®šã™ã‚‹ï¼ˆ`canGoBack`ï¼‰
- `canGoBack` ãŒ `true` ã®å ´åˆã¯ `navController.popBackStack()` ã‚’å‘¼ã³å‡ºã—ã¦ `navigation-compose` å†…ã§ä¸€ã¤å‰ã®ç”»é¢ã«æˆ»ã™
- `canGoBack` ãŒ `false` ã®å ´åˆï¼ˆã¤ã¾ã‚Šã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ã®æœ€åˆã®ç”»é¢ã«ã„ã‚‹å ´åˆï¼‰ã¯ `BackHandler` ãŒç„¡åŠ¹ã«ãªã‚Šã€çµæœã¨ã—ã¦ `BottomSheetDialog` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒãƒƒã‚¯ã‚­ãƒ¼å‡¦ç†ãŒå®Ÿè¡Œã•ã‚Œã€Fragment è‡ªä½“ãŒé–‰ã˜ã‚‰ã‚Œã‚‹ã“ã¨ã«ãªã‚‹

```kotlin
abstract class ComposeDialogFragment : BottomSheetDialogFragment() {

    // onCreateDialog ã¨ onCreateView ã¯å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§å®šç¾©æ¸ˆã¿
    override fun onCreateDialog(savedInstanceState: Bundle?): Dialog { /* ... (å‰è¿°ã®ã‚³ãƒ¼ãƒ‰) ... */ }

    override fun onCreateView(
        inflater: LayoutInflater, 
        container: ViewGroup?, 
        savedInstanceState: Bundle?
    ): View { /* ... (å‰è¿°ã®ã‚³ãƒ¼ãƒ‰) ... */ }

    @Composable
    abstract fun Content()

    @Composable
    protected fun ComposeDialogFragmentNavHost(
        navController: NavHostController,
        startDestination: Any,
        modifier: Modifier = Modifier,
        contentAlignment: Alignment = Alignment.TopStart,
        route: KClass<*>? = null,
        typeMap: Map<KType, @JvmSuppressWildcards NavType<*>> = emptyMap(),
        enterTransition: (@JvmSuppressWildcards AnimatedContentTransitionScope<NavBackStackEntry>.() -> EnterTransition) = { fadeIn(animationSpec = tween(700)) },
        exitTransition: (@JvmSuppressWildcards AnimatedContentTransitionScope<NavBackStackEntry>.() -> ExitTransition) = { fadeOut(animationSpec = tween(700)) },
        popEnterTransition: (@JvmSuppressWildcards AnimatedContentTransitionScope<NavBackStackEntry>.() -> EnterTransition) = enterTransition,
        popExitTransition: (@JvmSuppressWildcards AnimatedContentTransitionScope<NavBackStackEntry>.() -> ExitTransition) = exitTransition,
        sizeTransform: (@JvmSuppressWildcards AnimatedContentTransitionScope<NavBackStackEntry>.() -> SizeTransform?)? = null,
        builder: NavGraphBuilder.() -> Unit,
    ) {
        // LocalOnBackPressedDispatcherOwner ã‚’ç¾åœ¨ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚° (BottomSheetDialog) ã«è¨­å®š
        CompositionLocalProvider(LocalOnBackPressedDispatcherOwner provides (dialog as BottomSheetDialog)) {
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ãƒƒã‚¯ã«æˆ»ã‚‹ã¹ãç”»é¢ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç›£è¦–
            val canGoBack by produceState(initialValue = false, key1 = navController) {
                @SuppressLint("RestrictedApi") // currentBackStack ã®ä½¿ç”¨ã«å¿…è¦
                navController.currentBackStack
                    .map { backStack ->
                        backStack.count { it.destination !is NavGraph } > 1
                    }
                    .collect { value = it }
            }

            BackHandler(enabled = canGoBack) {
                navController.popBackStack()
            }

            NavHost(
                navController = navController,
                startDestination = startDestination,
                modifier = modifier,
                contentAlignment = contentAlignment,
                route = route,
                typeMap = typeMap,
                enterTransition = enterTransition,
                exitTransition = exitTransition,
                popEnterTransition = popEnterTransition,
                popExitTransition = popExitTransition,
                sizeTransform = sizeTransform,
                builder = builder,
            )
        }
    }
}
```

ã“ã® `ComposeDialogFragmentNavHost` ã‚’ä½¿ã£ãŸå…·ä½“çš„ãªå®Ÿè£…ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
`ComposeDialogFragment` ã‚’ç¶™æ‰¿ã—ãŸ `SampleDialogFragment` ã‚’ä½œæˆã—ã€`Content` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ `ComposeDialogFragmentNavHost` ã‚’å‘¼ã³å‡ºã—ã¦ç”»é¢é·ç§»ã‚’å®šç¾©ã—ã¾ã™ã€‚

```kotlin
// ç”»é¢é·ç§»å…ˆã‚’å®šç¾©
@Serializable
object FirstScreen

@Serializable
object SecondScreen

@Composable
private fun Screen(
    title: String,
    onBackButtonClicked: () -> Unit,
    buttonContent: @Composable () -> Unit,
) {
    Column(modifier = Modifier.fillMaxSize()) {
        @OptIn(ExperimentalMaterial3Api::class)
        TopAppBar(
            title = { Text(text = title) },
            navigationIcon = {
                IconButton(onClick = onBackButtonClicked) {
                    Icon(imageVector = Icons.AutoMirrored.Filled.ArrowBack, contentDescription = "Back")
                }
            },
        )

        Box(
            modifier = Modifier
                .fillMaxSize()
                .wrapContentSize()
        ) {
            buttonContent()
        }
    }
}

class SampleDialogFragment : ComposeDialogFragment() {
    @Composable
    override fun Content() {
        // ã“ã® Dispatcher ã¯ Fragment è‡ªä½“ã‚’é–‰ã˜ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ (NavHost ã®å¤–å´ã®ãƒãƒƒã‚¯å‡¦ç†)
        // ä¾‹ãˆã°ã€TopAppBar ã®æˆ»ã‚‹ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ãã« Fragment ã‚’é–‰ã˜ã‚‹å ´åˆãªã©ã€‚
        val onBackPressedDispatcher = LocalOnBackPressedDispatcherOwner.current?.onBackPressedDispatcher
        val navController = rememberNavController()

        ComposeDialogFragmentNavHost(
            navController = navController,
            startDestination = FirstScreen
        ) {
            composable<FirstScreen> {
                Screen(
                    title = "First Screen",
                    onBackButtonClicked = { onBackPressedDispatcher?.onBackPressed() },
                ) {
                    Button(onClick = { navController.navigate(SecondScreen) }) {
                        Text(text = "Go to Second Screen")
                    }
                }
            }

            composable<SecondScreen> {
                Screen(
                    title = "Second Screen",
                    onBackButtonClicked = { onBackPressedDispatcher?.onBackPressed() },
                ) {
                }
            }
        }
    }
}
```

ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ã€`FirstScreen` ã‹ã‚‰ `SecondScreen` ã¸ã¨é·ç§»ã™ã‚‹ç°¡å˜ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚`ComposeDialogFragmentNavHost` ã«ã‚ˆã£ã¦ã€`SecondScreen` ã§ãƒ‡ãƒã‚¤ã‚¹ã®ãƒãƒƒã‚¯ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ `FirstScreen` ã«æˆ»ã‚Šã€`FirstScreen` ã§ãƒãƒƒã‚¯ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ `SampleDialogFragment` è‡ªä½“ãŒé–‰ã˜ã‚‹ã€ã¨ã„ã†æœŸå¾…é€šã‚Šã®æŒ™å‹•ã«ãªã‚Šã¾ã™ã€‚
å„ç”»é¢ã® `Screen` ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«ã«æ¸¡ã—ã¦ã„ã‚‹ `onBackButtonClicked` ã¯ã€ä¸»ã« `TopAppBar` ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆæˆ»ã‚‹çŸ¢å°ï¼‰ãŒæŠ¼ã•ã‚ŒãŸéš›ã« Fragment è‡ªä½“ã‚’é–‰ã˜ã‚‹ãŸã‚ã®å‡¦ç†ã§ã™ã€‚ã“ã‚Œã¯ `ComposeDialogFragmentNavHost` ã«ã‚ˆã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®ãƒãƒƒã‚¯ã‚­ãƒ¼åˆ¶å¾¡ã¨ã¯ç‹¬ç«‹ã—ã¦å‹•ä½œã—ã¾ã™ã€‚

## æœ€å¾Œã«

ä»Šå›ã¯ã€`BottomSheetDialogFragment` ã‚’ä½¿ã£ã¦ Jetpack Compose ã®ç”»é¢ã‚’ã‚ˆã‚ŠæŸ”è»Ÿã«ã€ãã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦å¿«é©ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã„ãã¤ã‹ã®é‡è¦ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ã”ç´¹ä»‹ã—ã¾ã—ãŸã€‚

ã“ã‚Œã‚‰ã®æ–¹æ³•ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ç‰¹ã« React Native ã®ã‚ˆã†ãªæ—¢å­˜ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ãƒã‚¤ãƒ†ã‚£ãƒ–ã® Jetpack Compose ã‚’çµ„ã¿åˆã‚ã›ã‚‹ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒªé–‹ç™ºã«ãŠã„ã¦ã€ã‚ˆã‚Šã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãª UI / UX ã‚’æä¾›ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã“ã®è¨˜äº‹ãŒã€çš†ã•ã‚“ã® Android ã‚¢ãƒ—ãƒªé–‹ç™ºã®ä¸€åŠ©ã¨ãªã‚Œã°å¹¸ã„ã§ã™ï¼

---

ã‚‚ã£ã¨ã‚¢ãƒ«ãƒ€ã‚°ãƒ©ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢çµ„ç¹”ã‚’çŸ¥ã‚ŠãŸã„äººã€ãœã²ä¸‹è¨˜ã®æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ï¼
